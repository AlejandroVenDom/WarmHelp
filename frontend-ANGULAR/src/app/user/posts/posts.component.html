<div class="publicaciones-container">
  <h2>PUBLICACIONES RECIENTES</h2>

  <!-- ACCIONES -->
  <div class="acciones-posts">
    <div class="buscador-posts">
      <i class="bi bi-search"></i>
      <input type="text" placeholder="Buscar publicaciones..." />
    </div>
    <button class="btn-publicar" (click)="abrirModalNuevoPost()">
      <i class="bi bi-plus-circle-fill"></i>
      Publicar
    </button>
  </div>

  <!-- LISTA DE POSTS --> 
  <div class="card-post" *ngFor="let post of posts">
    <img src="/ans.jpg" class="avatar" />
    <div class="content" [ngClass]="{ 'with-image': post.image }">
      <div class="header">
        <span class="username">{{ post.username || 'Usuario' }}</span>
        <span class="time">{{ post.createdAt | date:'short' }}</span>
      </div>
      <h4>{{ post.title }}</h4>
      <p>{{ post.description }}</p>
      <img *ngIf="post.image" [src]="post.image" class="post-image" />
      <div class="actions">
        <i class="bi bi-hand-thumbs-up"></i><span>0</span>
        <i class="bi bi-chat-left-text-fill" (click)="abrirModalComentarios(post)" style="cursor: pointer;"></i>
        <span>{{ post.comments?.length || 0 }}</span>
      </div>
    </div>
  </div>

  <!-- MODAL NUEVO POST -->
  <div *ngIf="modalNuevoPost" class="modal">
    <div class="modal-content">
      <span class="close-btn" (click)="cerrarModalNuevoPost()">
        <i class="bi bi-x-lg"></i>
      </span>
      <h3>Crear nueva publicación</h3>
      <div class="form-group">
        <label for="titulo">Título</label>
        <input id="titulo" type="text" [(ngModel)]="nuevoPost.title" placeholder="Título del post..." />
      </div>
      <div class="form-group">
        <label for="descripcion">Descripción</label>
        <textarea id="descripcion" rows="4" [(ngModel)]="nuevoPost.description" placeholder="¿Qué quieres compartir?"></textarea>
      </div>
      <div class="form-group">
        <label for="imagen">Imagen (URL)</label>
        <input id="imagen" type="text" [(ngModel)]="nuevoPost.image" placeholder="https://..." />
      </div>
      <button class="btn-publicar-modal" (click)="publicarPost()">
        <i class="bi bi-send-fill"></i> Publicar
      </button>
    </div>
  </div>

  <!-- MODAL COMENTARIOS -->
  <div *ngIf="modalComentariosVisible && postSeleccionado" class="modal">
    <div class="modal-content">
      <span class="close-btn" (click)="cerrarModalComentarios()">
        <i class="bi bi-x-lg"></i>
      </span>

      <h3 *ngIf="!mostrandoRespuestas">Comentarios</h3>
      <h3 *ngIf="mostrandoRespuestas">Respuestas a {{ comentarioSeleccionado?.username || 'Usuario' }}</h3>

      <!-- COMENTARIOS -->
      <div *ngIf="!mostrandoRespuestas">
        <div class="comentario" *ngFor="let comentario of comentarios">
          <div class="comentario-header">
            <strong>{{ comentario.username || 'Usuario' }}</strong>
          </div>
          <p>{{ comentario.description }}</p>
          <div class="comentario-actions">
            <span><i class="bi bi-hand-thumbs-up"></i> 0</span>
            <button class="btn-responder" (click)="verRespuestas(comentario)">
              <i class="bi bi-reply-fill"></i> Responder
            </button>
          </div>

          <!-- NUEVO: ÍCONO DE RESPUESTAS -->
          <div *ngIf="comentario.responseComments?.length > 0"
               class="respuestas-count"
               (click)="verRespuestas(comentario)">
            <i class="bi bi-chat-left-dots-fill"></i>
            {{ comentario.responseComments.length }} respuesta{{ comentario.responseComments.length > 1 ? 's' : '' }}
          </div>
        </div>
      </div>

      <!-- RESPUESTAS DETALLADAS -->
      <div *ngIf="mostrandoRespuestas && comentarioSeleccionado">
        <div class="comentario comentario-principal">
          <div class="comentario-header">
            <strong>{{ comentarioSeleccionado.username || 'Usuario' }}</strong>
          </div>
          <p>{{ comentarioSeleccionado.description }}</p>
          <div class="comentario-actions">
            <span><i class="bi bi-hand-thumbs-up"></i> 0</span>
          </div>
        </div>

        <div class="respuesta" *ngFor="let respuesta of comentarioSeleccionado.responseComments">
          <div class="comentario-header">
            <strong>{{ respuesta.username || 'Usuario' }}</strong>
          </div>
          <p>{{ respuesta.description }}</p>
          <div class="comentario-actions">
            <span><i class="bi bi-clock"></i> {{ respuesta.createdAt | date:'short' }}</span>
          </div>
        </div>
      </div>

      <!-- INPUT COMENTARIO/RESPUESTA -->
      <div class="comentar-barra">
        <input *ngIf="!mostrandoRespuestas"
               type="text"
               [(ngModel)]="nuevoComentario"
               placeholder="Escribe tu comentario..." />

        <input *ngIf="mostrandoRespuestas"
               type="text"
               [(ngModel)]="nuevaRespuesta"
               placeholder="Escribe tu respuesta..." />

        <button class="btn-comentar" (click)="mostrandoRespuestas ? enviarRespuesta() : enviarComentario()">
          <i class="bi bi-reply-all-fill"></i>
          {{ mostrandoRespuestas ? 'Responder' : 'Comentar' }}
        </button>
      </div>

      <button class="btn-volver" *ngIf="mostrandoRespuestas" (click)="volverAComentarios()">
        <i class="bi bi-arrow-left-circle"></i> Volver a comentarios
      </button>
    </div>
  </div>
</div>
