<div class="chat-container">
  <!-- Sidebar -->
  <aside class="chat-sidebar">
    <div class="sidebar-header">
      <h2>Conversaciones</h2>
    </div>

    <div class="chat-section">
      <h4>
        <i class="bi bi-chat-dots"></i> Mis Chats
        <button class="toggle-button" (click)="toggleChats()" title="Mostrar/Ocultar">
          <i class="bi" [ngClass]="showChats ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
      </h4>

      <ul *ngIf="showChats">
  <li *ngFor="let chat of chatList" class="chat-item" (click)="selectChat(chat)">
    <div class="chat-info">
      <img
        [src]="getAvatarUrl(getChatOpponent(chat)?.avatar)"
        alt="avatar"
        class="avatar"
        (error)="onImageError($event)" />
      <span>{{ getChatOpponent(chat)?.username }}</span>
    </div>
    <button class="delete-chat" (click)="deleteChat(chat)">
      <i class="bi bi-trash3-fill"></i>
    </button>
  </li>
</ul>

    </div>

    <div class="chat-section">
      <h4>
        <i class="bi bi-person-plus"></i> Iniciar nuevo chat
        <button class="toggle-button" (click)="toggleNewChats()" title="Mostrar/Ocultar">
          <i class="bi" [ngClass]="showNewChat ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
      </h4>

      <ul *ngIf="showNewChat">
        <li *ngFor="let user of users" (click)="startChatWith(user)" class="chat-user">
          <div class="chat-info">
            <img [src]="getAvatarUrl(user.avatar)"
                 alt="avatar"
                 class="avatar"
                 (error)="onImageError($event)" />
            <span>{{ user.username }}</span>
          </div>
        </li>
      </ul>
    </div>
  </aside>

  <!-- Panel de conversación -->
  <section class="chat-panel" *ngIf="currentChat">
    <div class="chat-header"
         (click)="verPerfilPublico(getChatOpponent(currentChat)?.username); $event.stopPropagation()">
      <img class="chat-avatar"
           [src]="getAvatarUrl(getChatOpponent(currentChat)?.avatar)"
           (error)="onImageError($event)" />
      <h3>{{ getChatOpponent(currentChat)?.username }}</h3>
    </div>

    <div class="chat-body" #scrollContainer>
      <div *ngIf="messages.length === 0" class="no-messages">No hay mensajes aún.</div>
      <div *ngFor="let msg of messages"
           [ngClass]="{'my-message': isMyMessage(msg), 'other-message': !isMyMessage(msg)}"
           class="message-bubble">
        <p>{{ msg.content }}</p>
        <span class="timestamp">{{ msg.timestamp || '...' }}</span>
      </div>
    </div>

    <div class="chat-footer">
      <input [(ngModel)]="newMessage"
             placeholder="Escribe un mensaje..."
             (keyup.enter)="sendMessage()" />
      <button (click)="sendMessage()">
        <i class="bi bi-send-fill"></i>
      </button>
    </div>
  </section>
</div>
